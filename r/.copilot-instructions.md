applyTo: "r/**/*.R"

# R Layer Instructions (Current State: No R Source Present)

This file documents ACTUAL patterns detected in the existing `r/` directory. At the time of writing, there are no R files or Bioconductor package code in the repository. Do not invent S4 classes, functions, or usage examples. Use this as a guardrail until real R code is added.

---

## 1. S4 Classes (setClass)
Detected definitions: none (no `setClass()` calls found).
Slots in use: n/a.
Validation methods: n/a.
Examples: none available. Add real examples once classes are implemented.

Required approach when adding first S4 class:
- Use `setClass("NhAnesCycleData", slots = c(cycle = "character", se = "SummarizedExperiment"))`
- Provide constructor that validates cycle format `YYYY-YYYY`.

---

## 2. Bioconductor Classes (Future/Optional for Tabular Analysis)
Current usage: none. This is not relevant to the pesticide RAG pipeline.
Construction patterns: not yet present.
Do not fabricate usage. Introduce only after adding actual imports for structured data analysis.

Planned (based on project standards in [.github/copilot-instructions.md](../.github/copilot-instructions.md)):
- `SummarizedExperiment` for merged assay + demographics.
- Arrow Parquet output for cross-language exchange.

---

## 3. Function Patterns
No R functions found (no `.R` source files).
Therefore:
- No observed naming pattern (expected future: snake_case).
- No observed argument structuring.
- No observed input validation (expected: `stopifnot()` or explicit `if (...) stop()`).
- No observed return conventions.

---

## 4. Documentation (roxygen2)
No roxygen2 comment blocks present (no R source).
When adding functions/classes:
- Minimum tags: `@title`, `@description`, `@param`, `@return`, `@examples`, `@export`.

---

## 5. Data Handling
Observed R data reading/writing in repository: none.
Planned (from setup guides):
- Write Parquet: `arrow::write_parquet(df, file.path("shared_data", "<date>_artifact.parquet"))`
- Read Parquet: `arrow::read_parquet(path)`
File path construction should use `file.path()` (not string concatenation).

---

## 6. Dependencies
Loaded R packages detected: none (no library()/require() calls).
Planned dependencies (not yet implemented): `arrow`, `SummarizedExperiment`, `BiocCheck`, `testthat`, `jsonlite`.
Add entries to `DESCRIPTION` once the R package scaffold is created.

---

## 7. Testing (testthat)
No `tests/testthat/` directory under `r/`.
Planned pattern:
- Each feature gets a `test-<topic>.R`.
- Use `test_that("<behavior>", { ... })`.
- Validate S4 class slots and Parquet round-trips.

---

## 8. Error Handling
No R error/warning/message patterns yet.
Planned style:
- Use `stop()` with informative messages for invalid cycles, missing columns.
- Use `warning()` sparingly (e.g., partial column availability).
- Avoid silent failures.

---

## 9. Cross-Language Data Exchange
Current R → Python exchange: none (no R code).
Planned protocol only:
- Parquet in `shared_data/` (never CSV; never reticulate).
- Naming: `YYYY-MM-DD_<descriptor>.parquet`.

---

## 10. Interim Guardrails
Until actual R code exists:
- Reject generation of fictitious historical classes/functions.
- Only scaffold minimal, testable structures when explicitly prompted.
- Keep first commit small (one S4 class + constructor + test + roxygen2 docs).

---

## 11. First Implementation Checklist (For Future Use)
When you add initial R code, ensure:
- Create `r/DESCRIPTION`, `r/NAMESPACE`.
- Add one S4 class with validation.
- Add roxygen2 docs and run `roxygen2::roxygenise()`.
- Add `tests/testthat/test-class.R`.
- Export Parquet sample for Python consumption.

---

## 12. What NOT To Do Now
- Do not reference nonexistent R objects in Python.
- Do not generate reticulate bridges.
- Do not invent GRanges/genomic abstractions unrelated to NHANES.

---

## 13. Example Prompt (Deferred Until Code Exists)
```
Follow r/.copilot-instructions.md; create NhAnesCycleData S4 class with cycle validation (YYYY-YYYY), constructor, roxygen2 docs, and testthat round-trip parquet test.
```

---

## 14. Update Policy
Replace all “none” / “not yet present” sections with concrete examples immediately after first R commit. Keep this file synchronized with actual code evolution.

---
